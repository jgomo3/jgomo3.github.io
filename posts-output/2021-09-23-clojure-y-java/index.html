<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
    <meta charset="utf-8"/>
    <title>Blog de Jesús Gómez (jgomo3): Clojure y Java</title>
    
<meta name="keywords" content="Clojure,es,Java,borrador,ftp-hog,MailHog">

<meta name="description" content="Clojure el jar (BORRADOR)Clojure es distribuido en realidad como un paquete .jar.">

<meta property="og:description" content="Clojure el jar (BORRADOR)Clojure es distribuido en realidad como un paquete .jar.">

<meta property="og:url" content="http://jgomo3.info/posts-output/2021-09-23-clojure-y-java/" />
<meta property="og:title" content="Clojure y Java" />
<meta property="og:type" content="article" />

    <link rel="canonical" href="http://jgomo3.info/posts-output/2021-09-23-clojure-y-java/">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="//fonts.googleapis.com/css?family=Alegreya:400italic,700italic,400,700" rel="stylesheet"
          type="text/css">
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/css/bootstrap.min.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.2.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.7.0/styles/default.min.css">
    <link href="/css/screen.css" rel="stylesheet" type="text/css" />
</head>
<body>


<nav class="navbar navbar-default">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Blog de Jesús Gómez (jgomo3)</a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
            <ul class="nav navbar-nav navbar-right">
                <li ><a href="/">Home</a></li>
                <li
                ><a href="/archives/">Archives</a></li>
                
                <li
                >
                <a href="/pages-output/acerca-de-mi/">Acerca de mi</a>
                </li>
                
                <li><a href="/feed.xml">RSS</a></li>
                <li class="dropdown">
                    <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
                        More <span class="caret"></span></a>
                    <ul class="dropdown-menu" role="menu">
                        <!-- <li class="dropdown-header">Links</li> -->
                        <!-- <li><a href="http://cryogenweb.org/docs/home.html">Cryogen Docs</a></li> -->
                        <!-- <li><a href="https://carmen.la/blog/archives/">Carmen's Blog</a></li> -->
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Recent Posts</li>
                        
                        <li><a href="/posts-output/2021-09-23-clojure-y-java/">Clojure y Java</a></li>
                        
                        <li><a href="/posts-output/2021-07-21-ftp-hog/">ftp-hog: sencillo servidor ftp a la MailHog</a></li>
                        
                        <li><a href="/posts-output/2020-11-07-actualización-del-blog/">Actualización del blog</a></li>
                        
                        

                        
                        <li class="divider"></li>
                        <li class="dropdown-header">Tags</li>
                        
                        <li><a href="/tags-output/Clojure/">Clojure</a></li>
                        
                        <li><a href="/tags-output/es/">es</a></li>
                        
                        <li><a href="/tags-output/Java/">Java</a></li>
                        
                        <li><a href="/tags-output/borrador/">borrador</a></li>
                        
                        <li><a href="/tags-output/ftp-hog/">ftp-hog</a></li>
                        
                        <li><a href="/tags-output/MailHog/">MailHog</a></li>
                        
                        
                    </ul>
                </li>
            </ul>
        </div><!--/.nav-collapse -->
    </div><!--/.container-fluid -->
</nav>


<div class="container">


    <div class="row">
        <div class="col-lg-12">
            <div id="content">
                
<div id="post">
    <div class="post-header">
    <div id="post-meta" class="row">
        <div class="col-lg-6">September 23, 2021</div>
        
    </div>
    <h2>Clojure y Java</h2>
</div>
<div>
    
    <h2 id="clojure-el-jar-borrador">Clojure el jar (BORRADOR)</h2><p>Clojure es distribuido en realidad como un paquete <code>.jar</code>.</p><p>La forma más básica de utilizarlo es ejecutando:</p><pre><code class="shell">$ java -jar clojure.jar
</code></pre><p>En cuyo caso, una sesión interactiva con el "REPL" inicia.</p><pre><code class="Clojure">Clojure 1.11.0-master-SNAPSHOT
user=&gt; (+ 1 1)
2
</code></pre><p>Otra forma de interesante de invocar Clojure es incluyendo el paquete
<code>clojure.jar</code> explícitamente en el "Class Path" y ejecutar su "clase
principal".</p><pre><code class="shell">$ java -cp clojure.jar clojure.main
Clojure 1.11.0-master-SNAPSHOT
user=&gt; 
</code></pre><p>Nota:</p><p>La clase principal de un paquete ".jar" está definida en su
manifiesto (META-INF/MANIFEST.MF).</p><pre><code class="shell">$ jar xf clojure.jar META-INF/MANIFEST.MF
$ grep Main-Class META-INF/MANIFEST.MF 
Main-Class: clojure.main
</code></pre><p>Pasar un libreto («script») como argumento evita la sesión interactiva
con el "REPL" y Clojure interpreta expresión por expresión dicho
libreto.</p><p>Supongamos que tenemos un archivo llamado <code>hola.clj</code> con el siguiente
contenido:</p><pre><code class="Clojure">(println "Hola Infinito")
</code></pre><p>Entonces el mensaje "Hola Infinito" será producido por la salida
estándar después de ejecutar lo siguiente:</p><pre><code class="Shell">$ java -jar clojure.jar hola.clj
Hola Infinito
$ 
</code></pre><p>Si el libreto es <code>-</code>, entonces lee dicho libreto de la entrada
estándar. Es decir, otra forma de lograr el mismo resultado de
ejecutar el libreto "hola.clj", hubiera sido:</p><pre><code class="Shell">$ echo '(println "Hola Infinito")' | java -jar clojure.jar -
Hola Infinito
</code></pre><p>Que también podría haberse logrado usando la opción <code>-e</code>, que hace que
clojure evalúe la expresión determinada Y la produzca por la salida
estándar.</p><pre><code class="Shell">$ java -jar clojure.jar -e '"Hola Infinito"'
Hola Infinito
</code></pre><p>Nota:</p><p>En este caso, no hizo falta utilizar la función <code>println</code>, porque <code>-e</code>
no sólo evalúa la expresión dada, sino que su resultado lo coloca en
la salida estándar.</p><p>Las comillas simples son para indicarle al «shell» que no trate de
interpretar nada del contenido que encierran. De esta manera, podemos
escribir las comillas dobles (<code>"</code>) con la seguridad de que serán
recibidas por Clojure, en cuyo momento, representan el inicio y el
final de una cadena de caracteres.</p><p>Puedes pedirle a Clojure que evalúe varias expresiones a la
vez. Producirá una línea por valor en la salida estándar:</p><pre><code class="Shell">$ java -jar clojure.jar -e 1 -e 2 -e 3
1
2
3
</code></pre><p>Con la opción <code>-m</code>, Clojure llama la función <code>-main</code> del espacio de
nombre que especifiquemos.</p><p>Supongamos un archivo llamado <code>hola.clj</code> en la carpeta actual, con
este contenido:</p><pre><code class="Clojure">(ns hola)

(defn -main [&amp; args]
  (println "Hola Infinito"))
</code></pre><p>Entonces, esa función <code>-main</code> la podemos ejecutar de la siguiente manera:</p><pre><code class="Shell">$ java -cp ".:clojure.jar" clojure.main -m hola
</code></pre><p>Nota que utilizamos la forma con el <code>-cp</code> en vez del <code>-jar</code>. Esto es
debido a que debemos colocar en el Class Path el directorio actual
(<code>.</code>) para que consiguiera nuestro archivo <code>hola.clj</code>.</p><p>Pero ¿cómo obtener el <code>.jar</code>?</p><p>Una forma de generarlo es siguiendo as instrucciones de la guía de
iniciación («Getting Started») en la sección «Otras maneras de correr
Clojure» («Other ways to run Clojure»)[1]:</p><pre><code>git clone https://github.com/clojure/clojure.git
cd clojure
mvn -Plocal -Dmaven.test.skip=true package
</code></pre><p>El paquete <code>clojure.jar</code> generado tendrá todas las dependencias
necesarias para soportar todo el lenguaje.</p><p>[1] https://clojure.org/guides/getting_started#_other_ways_to_run_clojure</p><h2 id="clojure-cli">Clojure CLI</h2><p>Hasta ahora hemos visto cómo utilizar Clojure de forma muy
trivial. Para claridad me refreiré a esta forma como <code>clojure.main</code>.</p><p>Para programas más complejos, dividido en módulos, que dependan de
bibliotecas de terceros, que requieran «recursos», etc., puede ser muy
complicado preparar el entorno de ejecución para que el programa pueda
acceder a dichas elementos.</p><p><strong>clojure.org</strong> pone a nuestra disposición unas herramientas que nos
permite utilizar Clojure de una forma más simple desde la línea de
órdenes, y organiza los elementos mencionados en el párrafo anterior
(en particular, construyen el Class Path por nosotros).</p><p>Estas herramientas se conocen como «Las herramientas para el
Intérprete de la Línea de Órdenes», a las cuales nos referiremos como
«Clojure CLI»</p><p>Hay varios métodos de instalación. Cada distribución de Sistema
Operativo muy posiblemente las tendrá a disposición con el nombre de
<code>clojure</code>.</p><p>Exploraremos aquí la manera de instalar estas herramientas
independientemente de la distribución de Sistema Operativo.</p><p>Estas herramientas necesitan:</p><ul><li>bash</li><li>java</li><li>rlwrap (opcional)</li></ul><p>En <strong>clojure.org</strong> hay un libreto de instalación. Para el día de hoy,
la versión estable de Clojure es la versión <code>1.10.3.986</code>, así que
descargaremos el instalador de dicha versión y lo ejecutamos.</p><p>Si no indicamos nada, el instalador intentará instalar las
herramientas a nivel del sistema (<code>/usr/bin</code>, etc.). En ese caso,
habría que tener permisos para hacerlo (<code>sudo</code> por ejemplo).</p><p>Pero con la opción <code>--prefix</code> se puede indicar un destino
alternativo. Hagamos eso, instalemos en <code>~/clojure</code></p><pre><code class="bash">$ wget https://download.clojure.org/install/linux-install-1.10.3.986.sh
$ chmod linux-install-1.10.3.986.sh
$ ./linux-install-1.10.3.986.sh --prefix=~/clojure
...
Installing libs into /home/.../clojure/lib/clojure
Installing clojure and clj into /home/.../clojure/bin
Installing man pages into /home/.../clojure/share/man/man1
</code></pre><p>En la carpeta donde se instaló, las herramientas están en la
subcarpeta <code>bin</code>: <code>clojure</code> y <code>clj</code>.</p><p><code>clojure</code> es la herramienta principal, es una herramienta de línea de
órdenes para iniciar programas escritos en Clojure (el lenguaje).</p><p><code>clj</code> es un simple envoltorio alrededor de <code>clojure</code> para hacer más
amena la interacción con el "REPL".</p><p>En la subcarpeta <code>share/man</code> se encuentra el manual en línea de estas
herramientas.</p><p>Entonces recomiendo indicarle al sistema la ubicación de estas
herramientas y sus manuales:</p><ul><li>Añadiendo a la variable de entorno <code>PATH</code> la subcarpeta <code>bin</code></li><li>Enseñándole a <code>man</code> cómo encontrar los manuales:
<ul><li>Si usas una distribución de Linux basada en Debian, añadiendo
<code>MANDATORY_MANPATH</code> al archivo <code>.manpath</code> del «$HOME».</li><li>Añadiendo una entrada al MANPATH_MAP que relacione la subcarpeta
<code>bin</code> con la subcarpeta <code>share/man</code>.</li></ul></li></ul><p>En este caso de ejemplo, y suponiendo un sistema Ubuntu:</p><pre><code class="bash">$ echo 'export PATH="$HOME/clojure/bin/:$PATH"' &gt;&gt; ~/.bashrc
$ echo 'MANDATORY_PATH home/ubuntu/clojure/share/man' &gt;&gt; ~/.manpath
</code></pre><p>Cuando utilizamos Clojure desde la consola, normalmente utilizamos
<code>clj</code> por ergonomía, y <code>clojure</code> en los libretos.</p><p>Las Clojure CLI están dirigidas por un archivo llamado <code>deps.edn</code>, que
merece su artículo completo.</p><p>Como las Clojure CLI son unos envoltorios alrededor de <code>clojure.main</code>,
todas las opciones del <code>clojure.main</code> están a nuestra
disposición. <code>-M</code> indica ejecutar <code>clojure.main</code>:</p><pre><code class="Shell">$ clj -M -e '(+ 1 1)'
</code></pre><p>Además de ellas, hay opciones para controlar las
direcciones establecidas por el <code>deps.edn</code>.</p><p>Creo que debo detener el artículo aquí. Mi intención era establecer un
puente entre las Clojure CLI y el <code>clojure.main</code>.</p>
</div>

<div id="post-tags">
    <b>Tags: </b>
    
    <a href="/tags-output/Clojure/">Clojure</a>
    
    <a href="/tags-output/es/">es</a>
    
    <a href="/tags-output/Java/">Java</a>
    
    <a href="/tags-output/borrador/">borrador</a>
    
</div>


    <div id="prev-next">
        
        
        <a class="right" href="/posts-output/2021-07-21-ftp-hog/">ftp-hog: sencillo servidor ftp a la MailHog &raquo;</a>
        
    </div>

    
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        var disqus_config = function () {
            this.page.url = "http://jgomo3.info/posts-output/2021-09-23-clojure-y-java/";
            this.page.identifier = "Clojure y Java";
        };
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//jgomo3-info.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    


</div>

            </div>
        </div>
    </div>
    <footer>Copyright &copy; 2021 Jesús Gómez
        <p style="text-align: center;">Powered by <a href="http://cryogenweb.org">Cryogen</a></p></footer>
</div>
<script src="//code.jquery.com/jquery-1.11.0.min.js"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
<script src="/js/highlight.pack.js" type="application/javascript"></script>
<script>hljs.initHighlightingOnLoad();</script>


</body>
</html>
